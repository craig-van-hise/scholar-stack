
### PRP: Hybrid Topic Expansion Refactor

**Role:** Senior Search Architect
**Task:** Refactor the Topic Expansion logic to capture both high-level synonyms and deep technical sub-fields.

#### 1. The "Dual-Axis" Prompt

Refine the LLM prompt to explicitly request these two categories.

* **Prompt Logic:**
"The user is researching **{topic}**.
1. List 10 **Direct Synonyms** or alternative names for this field (e.g., 'Spatial Audio' -> '3D Audio', 'Immersive Audio').
2. List 10 **Technical Sub-disciplines** or specific frameworks (e.g., 'Ambisonics', 'Wave Field Synthesis').
**Combine** these into a single comma-separated list of 20 terms."



#### 2. The Query Construction (The Net)

* **Logic:** `("Keyword") AND ("Topic" OR "Synonym1" OR "Synonym2" OR "SubDiscipline1" ...)`
* **Result:** This single query catches:
* The "Generalist" paper: *"Crosstalk Cancellation in **3D Audio** Systems"*
* The "Specialist" paper: *"Crosstalk Cancellation in **Ambisonics** Rendering"*



---

### Implementation Block for the Agent

Give this code to the agent. It ensures we don't miss the "3D Audio" whale while fishing for the "Ambisonics" minnows.

```python
    def search_via_direct_expansion(self):
        print(f"\nðŸš€ STARTING DIRECT EXPANSION SEARCH for: '{self.raw_topic}' + '{self.keywords_list[0]}'")
        
        # --- STEP 1: HYBRID TOPIC EXPANSION ---
        print("   ðŸ§  Expanding Topic Scope (Horizontal Synonyms + Vertical Sub-disciplines)...")
        prompt = (
            f"The user is researching '{self.raw_topic}'. Generate a combined list of 20 terms that include:\n"
            f"1. DIRECT SYNONYMS (e.g., '3D Audio', 'Immersive Sound').\n"
            f"2. TECHNICAL SUB-DISCIPLINES (e.g., 'Ambisonics', 'Wave Field Synthesis', 'Binaural').\n"
            f"Return ONLY a comma-separated list of the top 20 terms."
        )
        
        raw_synonyms = self.llm_query(prompt)
        # Clean and split
        topic_anchors = [s.strip().replace('"', '') for s in raw_synonyms.split(',') if len(s.strip()) > 3]
        
        print(f"   âœ… Generated {len(topic_anchors)} Hybrid Anchors: {topic_anchors[:5]}...")

        # --- STEP 2: CONSTRUCT THE SUPER-QUERY ---
        # Logic: (Keyword) AND (Topic OR Anchor1 OR Anchor2...)
        
        clean_keyword = self.keywords_list[0].replace('"', '')
        
        # Build the huge OR block
        topic_block = " OR ".join([f'"{t}"' for t in ([self.raw_topic] + topic_anchors)])
        
        # Final Query
        final_query = f'("{clean_keyword}") AND ({topic_block})'
        
        # ... execute ...

```

