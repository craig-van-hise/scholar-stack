
### PRP: The "Variable-Constraint" Backdoor

**Role:** Senior Generalist Search Engineer
**Task:** Refactor the Synonym Generation to use the User's Topic as a dynamic filter, eliminating "polysemic drift" (like "Active Control") without hardcoding domain terms.

#### 1. The Dynamic Anchor Prompt

Instead of injecting "Audio" words, inject the `self.raw_topic` variable into the prompt instructions.

* **Prompt Logic:**
"The user is researching **{topic}**. The primary keyword is **{keyword}**.
Below is a list of recent titles from a top expert in this field.
**Constraint:** This expert may work in multiple disciplines. You must **IGNORE** any titles or terms that are not strictly relevant to **{topic}**.
**Task:** Extract 15 technical synonyms, methods, or acronyms for **{keyword}** that appear in the relevant titles.
**Output:** Comma-separated list."

#### 2. Why this works for ANY field:

* **Case A (Current):** Input is "Spatial Audio". LLM sees "Seawater Concrete" title. LLM checks: "Is Seawater relevant to Spatial Audio?" -> No. Discards it.
* **Case B (Future):** Input is "Gene Editing". Expert also writes about "Patent Law". LLM checks: "Is Patent Law relevant to Gene Editing mechanisms?" -> No. Discards it. Keeps "Cas9".

#### 3. Execution (The Dragnet & Gate)

* **Dragnet:** `(Original Keyword OR Anchored_Synonyms)`.
* *Result:* "Active Control" is filtered out or qualified (e.g., "Active Noise Control") by the LLM because "Active Control" alone is too broad for the "Spatial Audio" topic constraint.


* **Gate:** The **PDF Front-Matter Audit** (Section-Aware) remains the final truth, checking for the original keyword.

---

### Implementation Block (General Purpose)

Here is the Python method that uses the variables correctly to sanitize the synonyms without hardcoding.

```python
def get_technical_synonyms_from_llm(self, titles, seed_keyword, user_topic):
    """
    Extracts synonyms using the User's Topic as the semantic guardrail.
    Works for any domain (Audio, Biology, Physics, etc.).
    """
    prompt = (
        f"CONTEXT: The user is researching '{user_topic}'. "
        f"The primary keyword is '{seed_keyword}'.\n"
        f"SOURCE DATA: Here are recent paper titles from a identified expert in this field:\n"
        f"{' | '.join(titles[:150])}\n\n"
        f"TASK: Identify 15 specific technical synonyms, acronyms, or method names for '{seed_keyword}' "
        f"that are used within the domain of '{user_topic}'.\n\n"
        f"RULES:\n"
        f"1. FILTER IRRELEVANCE: The expert may publish in other fields. IGNORE titles unrelated to '{user_topic}'.\n"
        f"2. PRECISION: If a term is broad (like 'Active Control'), qualify it to fit '{user_topic}' (e.g., 'Active Noise Control').\n"
        f"3. FORMAT: Return ONLY a comma-separated list of phrases (2-4 words). No full titles."
    )
    
    # ... call LLM ...

```

